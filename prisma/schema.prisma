generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String @id @default(uuid())
  name     String
  email    String @unique
  password String
  role     Role
  cpf    String  @unique
  phone  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  merchant Merchant?
  admin    Admin?
  address  Address?
  store    Store?
}

model Merchant {
  id           String  @id @default(uuid())
  userId       String  @unique
  cnpj         String  @unique
  businessName String
  phone        String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Admin {
  id       String  @id @default(uuid())
  userId   String  @unique
  position String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  CLIENT
  MERCHANT
  ADMIN
}

model Store {
  id          String  @id @default(uuid())
  name        String
  legalName   String
  cnpj        String  @unique
  description String?
  phone       String?
  email       String?

  userId    String @unique
  addressId String @unique

  user    User    @relation(fields: [userId], references: [id])
  address Address @relation(fields: [addressId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Address {
  id           String @id @default(cuid())
  postalCode   String
  street       String
  number       String
  neighborhood String
  city         String
  state        String

  userId  String? @unique
  storeId String?

  user  User?  @relation(fields: [userId], references: [id])
  store Store?
}
